---
title: 'Chapter 2: Use Case Notebook for Instructors'
author: "Ram Gopal, Dan Philps, and Tillman Weyde"
date: "Summer 2022"
output:
  word_document:
    toc: yes
    toc_depth: '4'
  pdf_document:
    toc: yes
    toc_depth: '4'
  html_document:
    theme: united
    highlight: tango
    toc: yes
    toc_float: yes
    toc_depth: 4
---

```{r setup, warning=FALSE,include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = TRUE)
results='markup' 
options(scipen = 999, digits = 4) #set to four decimal 

inline_hook <- function (x) {
  if (is.numeric(x)) {
    # ifelse does a vectorized comparison
    # If integer, print without decimal; otherwise print 4 places
    res <- ifelse(x == round(x),
      sprintf("%d", x),
      sprintf("%.4f", x)
    )
    paste(res, collapse = ", ")
  }
}
knit_hooks$set(inline = inline_hook)

```

# Use Case: Visualizing Industry Valuations

Sometimes, simply sorting and coloring items can help. For instance, if we were an entrepreneur or angel/venture cap investor, visualization can be used to quickly grasp which industries we should focus on, and which we should probably avoid. Earnings before interest tax, depreciation and amortization (EBITDA) is a commonly used analytic to proxy the cash generated by a business. It is widely used in corporate financial analysis, from credit analysis, through to public and private equities analysis. We will use a business analytic called “EBITDA multiple”, which is widely used in venture capital (VC) to value businesses: 

EBITDA multiple  = $EV / EBITDA $

Where Enterprise Value (EV) is the total value of a company’s equity plus debt capital, (including minority interests). Different industries will be valued by investors at different EBITDA multiples based on their perceived risk and return potential, or how “hot” an industry is considered by investors. Two companies in different industries, identical in all other respects, may be valued quite differently given these perceptions. (Investors can make excess returns if these perceptions are incorrect).  

## Sorting and Colors 

We can visualize the EBITDA multiples the market is currently pricing in, across industries by sorting sectors by EBITDA multiple, and plotting on a column chart. First, we create key indices. 

```{r}
library(readxl)
valuation_multiples <- read_excel("../../data/valuation multiples.xlsx")
df = valuation_multiples
df$EBITDA_margin = df$`EBITDA ($ millions)`/df$`Revenues ($ millions)`
df$Net_Margin = df$`Net Income ( $ millions)`/df$`Revenues ($ millions)`
df$Debt_EV = df$`Total Debt (including leases) ($ millions)`/df$`Enteprise Value ($ millions)`
df$EBITDA_EV = df$`EBITDA ($ millions)`/df$`Enteprise Value ($ millions)`
df$EBITDA_multiple = df$`EBITDA ($ millions)`/df$`Enteprise Value ($ millions)`
colnames(df)[1]="IndustryName"

```


```{r}
library(ggplot2)
df = df[order(df$EBITDA_multiple),]
ggplot(df,aes(x =`IndustryName`, y = EBITDA_multiple)) + 
  geom_col(size = 1) +
 theme(axis.text.x = element_text(angle = 90))
```
## Box plots to examine distributions of analytics: 

Box plots allow us to visualize the distribution of analytics such as “EBITDA multiple”, as you can see in the box plot below: 
```{r}
ggplot(df,aes(x = EBITDA_multiple)) + 
  geom_boxplot(col = "violet", fill = "lightblue", size = 1) + 
  theme_light() 
```

## Scatter plots to exploring drivers of valuation 

As VC investors we would want to understand what is driving different industry valuations and whether these drivers seem sensible. We can either resolve this question heuristically, i.e., through trial and error and gut instinct, or through a process of data exploration. We previously saw the power of scatter plots; we can expand this idea using bubble plots: 

```{r}
ggplot(df,aes(x =EBITDA_multiple, y = `EBITDA ($ millions)`),size=`Market Cap ($ millions)`) +   geom_point(col="magenta") 
```
We can also quickly analyze a pairwise relationship by plotting a line of best fit: 

```{r}
ggplot(df,aes(x =EBITDA_multiple, y = `EBITDA ($ millions)`)) + 
  geom_point(col="magenta")+
   geom_smooth()
```

## Clustering 

We can use our features to group similar instances together. This is called clustering. In this case we want to see which industries are similar with respect to certain vital stats: EBITDA margin, EBITDA to EV, and net margin. 

```{r}
clusters = hclust(dist(df[, c(1,3,6,9,13)]),method = "ward.D")
plot(clusters,labels = df$`IndustryName`)
```








